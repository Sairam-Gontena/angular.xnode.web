<div class="cr-tabs-div">
  <xnode-no-comments *ngIf="crData?.length === 0" [content]="'No open CRs yet'"></xnode-no-comments>
  <div *ngIf="crData?.length > 0">
    <div class="h-3rem p-0 m-0 w-full submit-cr-window grid align-items-center px-4 justify-content-between">
      <div class="p-0 m-0 flex col-5">
        <img src="../../assets/checkbox.svg" class="" alt="high" />
        <p class="text-xs ml-2 text-white">
          {{ checkedCrList?.length }}/{{ crData?.length }} items selected
        </p>
      </div>
      <div class="p-0 m-0 flex justify-content-between col-7 align-items-center">
        <img src="../../assets/archive.svg" class="submit-cr-window-icon" alt="archive" />
        <img src="../../assets/newuser.svg" class="submit-cr-window-icon" alt="adduser" />
        <img src="../../assets/status.svg" class="submit-cr-window-icon" alt="status" />
        <img src="../../assets/calender.svg" class="submit-cr-window-icon" alt="calender" />
        <img src="../../assets/link-cr.svg" class="submit-cr-window-icon" alt="link" />
        <p-button label="Update Spec" [rounded]="true" (click)="onClickUpdateSpec()"
          [disabled]="checkedCrList?.length ===0"></p-button>
      </div>
    </div>
    <div class="flex align-items-center justify-content-between w-full pt-2 pl-4 pr-4">
      <p-dropdown formControlName="product" [options]="filters" placeholder="Filter: All" optionLabel="title"
        class="custom-dropdown" [filter]="true" filterBy="title" filterPlaceholder="Search">
        <ng-template let-item pTemplate="item">
          <div class="col-12 flex align-items-center justify-content-between">
            <div class="title-container" [title]="item.title">
              {{ item.title }}
            </div>
          </div>
        </ng-template>
      </p-dropdown>
      <div>
        <i class="pi pi-search text-base mx-1 light-grey"></i>
        <i class="pi pi-user text-base mx-1 light-grey"></i>
      </div>
    </div>
    <div class="flex pl-4 pr-4 justify-content-between p-0">
      <p class="text-base light-grey text-sm">Today</p>
      <div class="flex align-items-center p-0">
        <i class="pi pi-arrow-up text-base mx-1 text-gray-200"></i>
        <p class="my-0 text-gray-200 text-sm">Date Created</p>
        <i class="pi pi-chevron-down text-base mx-1 text-gray-200"></i>
      </div>
    </div>
    <div>
      <div class="w-full pl-4 pr-4">
        <p-accordion class="cr-tabs" [multiple]="true" *ngFor="let data of crData;let i = index"
          (onOpen)="onAccordionOpen(data,i)">
          <p-accordionTab class="border-bottom-1 accordian mt-4">
            <ng-template pTemplate="header">
              <div class="w-full">
                <div class="grid col-12 flex-column">
                  <p-checkbox (onChange)="onCheckCheckbox($event)" [binary]="true" inputId="binary"
                    [(ngModel)]="data.checked"></p-checkbox>
                  <div class="flex flex-row align-items-center" style="position: absolute; margin-left: 13%">
                    <img src="../../assets/high.svg" class="" alt="high" />
                    <p class="p-0 m-0 text-xs ml-2">
                      <a href="" class="text-primary-500"># {{ data.crId }}</a>
                      <a href="" class="text-primary-500 ml-2" *ngIf="data.status ==='UPDATED'"
                        (click)="onClickViewChanges(data)">View Changes</a>

                    </p>
                  </div>
                  <div class="w-full pl-7">
                    <div class="flex align-items-center justify-content-between">
                      <div class="flex">
                        <img src="../../assets/todo.svg" alt="todo" />
                        <div class="flex align-items-center">
                          <p class="text-sm half-white pl-2">{{ data?.title }}</p>
                          <div class="ml-2 flex align-items-center border-1 pl-2 pr-2 border-round-2xl border-red-500"
                            *ngIf="data?.status == 'REJECTED'">
                            <div>
                              <i class="pi pi-times border-circle text-xs text-red-500"></i>
                            </div>
                            <div class="text-xs ml-2 text-red-500">Rejected</div>
                          </div>
                          <div *ngIf="data?.status == 'APPROVED'"
                            class="ml-2 flex align-items-center border-1 pl-2 pr-2 border-round-2xl border-green-500">
                            <div>
                              <i class="pi pi-check text-xs text-green-500"></i>
                            </div>
                            <div class="text-xs ml-2 text-green-500">
                              Approved
                            </div>
                          </div>
                          <div *ngIf="data?.status == 'NEEDMOREWORK'"
                            class="ml-2 flex align-items-center border-1 pl-2 pr-2 border-round-2xl border-orange-500">
                            <div>
                              <i class="pi pi-clock border-circle text-xs text-orange-500"></i>
                            </div>
                            <div class="text-xs ml-2 text-orange-500">
                              Need More Work
                            </div>
                          </div>
                          <div *ngIf="data?.status == 'DRAFT'"
                            class="ml-2 flex align-items-center border-1 pl-2 pr-2 border-round-2xl border-orange-500">
                            <div>
                              <i class="pi pi-clock border-circle text-xs text-orange-500"></i>
                            </div>
                            <div class="text-xs ml-2 text-orange-500">{{data.status}}</div>
                          </div>
                          <div *ngIf="data?.status == 'UPDATED'"
                            class="ml-2 flex align-items-center border-1 pl-2 pr-2 border-round-2xl border-orange-500">
                            <div>
                              <i class="pi pi-clock border-circle text-xs text-orange-500"></i>
                            </div>
                            <div class="text-xs ml-2 text-orange-500">{{data.status}}</div>
                          </div>
                          <div *ngIf="data?.status == 'SUBMITTED'"
                            class="ml-2 flex align-items-center border-1 pl-2 pr-2 border-round-2xl border-orange-500">
                            <div>
                              <i class="pi pi-clock border-circle text-xs text-orange-500"></i>
                            </div>
                            <div class="text-xs ml-2 text-orange-500">{{data.status}}</div>
                          </div>
                        </div>
                      </div>
                      <i class="pi pi-ellipsis-v text-base mx-1 text-gray-200" (click)="
                        op.toggle($event);
                        updateSelectedCr(data);
                        $event.stopPropagation()
                      "></i>
                    </div>
                    <div></div>
                    <div class="flex align-items-center pl-4" style="margin-top: -15px">
                      <p class="text-xs shaded-color normal-font-weight">
                        Due by : {{data.duedate | date}}
                      </p>
                      <img src="../../assets/Group.svg" class="ml-4" alt="CR" />
                      <span class="shaded-color ml-1 normal-font-weight">3</span>
                    </div>
                  </div>
                </div>
              </div>
            </ng-template>

            <ng-template pTemplate="content">
              <div class="pl-7 pr-4">
                <!-- dont delete write a comment code -->
                <div class="card m-0 p-0 mb-2" *ngIf="showComment">
                  <xnode-add-comment-overlay-panel [users]="usersList" [from]="'cr-tabs'"
                    placeHolder="Reason for your actions"
                    (commentInfo)="updateCommentsInfo($event)"></xnode-add-comment-overlay-panel>
                </div>
                <div class="border-bottom-1" [ngClass]="{ 'mt-4': i > 0 }"
                  *ngFor="let subData of crList[i]; let i = index">
                  <div class="flex flex-row justify-content-between align-items-center w-full">
                    <div class="w-full flex justify-content-between align-items-center">
                      <p class="my-0 text-gray-200 text-sm font-normal">
                        {{ subData?.comment?.referenceContent?.title }}
                      </p>
                      <div class="flex align-items-center ">
                        <div class="text-xs mr-2 text-orange-500">{{subData.status}}</div>
                        <span *ngFor="let reviewers of data?.reviewers">
                          <p-avatar [label]="getMeUserAvatar(reviewers)" class="text-xs" shape="circle" [style]="{
                            'background-color': '#9c27b0',
                            color: '#ffffff', fontSize: '10px'
                          }"></p-avatar>
                        </span>
                        <i class="pi pi-ellipsis-v text-base mx-1 text-gray-200"
                          (click)="op.toggle($event); $event.stopPropagation()"></i>
                      </div>
                    </div>
                  </div>
                  <div class="py-2 border-bottom-1 pr-4">
                    <div class="flex flex-row justify-content-between">
                      <div class="sctions-grid">
                        <!-- <div class="relative">
                          <i class="pi pi-plus text-sm border-1 border-200 border-round-sm mx-2"
                            [ngStyle]="{ 'background-color': '#EFEEEE' }"></i>
                        </div> -->
                        <div *ngIf="checktableJsonSection(subData?.comment  .referenceContent?.title); else normalView">
                          <!-- <p class="mt-0 content-title text-xs">{{subData?.comment.referenceContent.title }}</p> -->
                          <pre *ngIf="!subData?.comment.referenceContent?.showTable"
                            [innerHTML]="subData?.comment.referenceContent?.content | json"
                            style=" white-space: pre-wrap; overflow: auto"></pre>
                          <xnode-common-spec-table *ngIf="subData?.comment.referenceContent?.showTable"
                            [specItem]="subData?.comment.referenceContent?.content.content"
                            [content]="subData?.comment.referenceContent?.content"></xnode-common-spec-table>
                        </div>
                        <ng-template #normalView>
                          <p class="mt-0 content-title text-xs">{{subData?.comment.referenceContent.title }}</p>
                          <p class="text-content ml-3 pl-4 text-xs font-normal border-left-1 border-50">
                            {{ subData?.comment?.referenceContent?.content }}
                          </p>
                        </ng-template>
                        <div class="gradientback">
                        </div>
                      </div>
                    </div>
                    <span class="text-xs my-2 text-gray-200 flex align-items-center">
                      {{ subData.comment.message }}
                    </span>
                  </div>
                </div>
              </div>
            </ng-template>
          </p-accordionTab>
        </p-accordion>
      </div>
    </div>

    <p-overlayPanel #op>
      <div class="card p-0 m-0">
        <div class="flex align-items-center border-bottom-1 border-600 pointer pl-2 p-0 m-0"
          (click)="updateChagneRequestStatus('APPROVED'); op.toggle(false)">
          <i class="pi pi-check border-circle flex justify-content-center align-items-center text-xs bg-green-500"
            [ngStyle]="{ padding: '3px' }"></i>
          <p class="text-sm font-normal ml-1 text-green-500">Approve</p>
        </div>
        <div class="flex align-items-center border-bottom-1 border-600 pointer pl-2"
          (click)="updateChagneRequestStatus('REJECTED'); op.toggle(false)">
          <i class="pi pi-times border-circle flex justify-content-center align-items-center text-xs bg-red-500"
            [ngStyle]="{ padding: '3px' }"></i>
          <p class="text-sm font-normal ml-1 text-red-500">Reject</p>
        </div>
        <div class="flex align-items-center border-bottom-1 border-600 pointer pl-2"
          (click)="updateChagneRequestStatus('NEEDMOREWORK'); op.toggle(false)">
          <i class="pi pi-comment flex justify-content-center align-items-center text-xs" [ngStyle]="{}"></i>
          <p class="text-sm font-normal ml-1">Needs work</p>
        </div>
      </div>
    </p-overlayPanel>
  </div>
</div>
<xnode-confirmation-popup-new [header]="header" [content]="content"
  [visible]="openConfirmationPopUp || updateSpecBtnTriggered"
  (onClickAction)="onClickAction($event)"></xnode-confirmation-popup-new>